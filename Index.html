<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script> -->
    <script>
        let play = true;


        // document.addEventListener("DOMContentLoaded", function () {
        // var audioSpeech = document.getElementById('AudioSpeech');
        // const model = document.getElementById('LocutorModel');
        // const mediaButton = document.querySelector("#media-button");

        // audioSpeech.addEventListener("canplay", function () {
        // alert("Can start playing video");
        //audioSpeech.play();
        //audioSpeech.volume = 0;
        // });


        // mediaButton.addEventListener('click', function (evt) {
        // console.log("Button Clicked");
        // if (play) {
        // audioSpeech.play();
        // mediaButton.setAttribute("src", "#icon-stop");
        // model.setAttribute('animation-mixer', {
        // timeScale: 1,
        // });
        // }
        // else {
        // mediaButton.setAttribute("src", "#icon-play");
        // audioSpeech.pause();
        // model.setAttribute('animation-mixer', {
        // timeScale: 0,
        // });
        // }
        // play = !play;
        // });

        // });

        // AFRAME.registerComponent('mytarget', {
        // init: function () {
        // const model = document.getElementById('LocutorModel');
        // var audioSpeech = document.getElementById('AudioSpeech');
        // const mediaButton = document.querySelector("#media-button");

        // model.addEventListener('animation-loop', function (e) {
        // console.log("One Loop Finished");
        // mediaButton.setAttribute("src", "#icon-play");
        // play = true;
        // audioSpeech.pause();
        // audioSpeech.currentTime = 0;
        // audioSpeech.volume = 1;
        // model.setAttribute('animation-mixer', {
        // timeScale: 0,
        // })
        // });

        // this.el.addEventListener('targetFound', event => {
        // console.log("target found");
        // play = true;
        // mediaButton.setAttribute("src", "#icon-play");
        // model.setAttribute('animation-mixer', {
        // clip: "*",
        // loop: "repeat",
        // timeScale: 0,
        // });
        // });

        // this.el.addEventListener('targetLost', event => {
        // console.log("target Lost");
        // audioSpeech.pause();
        // audioSpeech.currentTime = 0
        // model.removeAttribute('animation-mixer');
        // });
        // }
        // });

        AFRAME.registerComponent('locutor_model', {
            init: function () {
                this.counter = 0;
                this.el.addEventListener('model-loaded', event => {
                    console.log("Locutor model loaded ...");
                    var objMesh = this.el.getObject3D('mesh');
                    this.material = this.el.getObject3D('mesh').material
                    console.log("THIS MATERIAL=  " + this.material);
                    /*objMesh.traverse(node => {
                       console.log("Name Mesh= " + node.name);
                       //console.log("type node= " + node.type);
                       var textureEl = node.material;
                       if (!textureEl) return;
                       console.log("material name= " + textureEl.map.name);
                       this.counter += 1;

                   });*/
                    objMesh.traverse((node) => {
                        //console.log("Name Node= " + node.name);
                        if (node.isMesh && node.material.map) {
                            //console.log("Name Mesh= " + node.name);
                            this.counter += 1;
                            //var texture = node.material.map;
                            console.log('material= ' + node.material.name)
                            console.log('Texture :', node.material);
                            document.querySelector('a-scene').renderer.setTexture2D(node.material.map, 0);
                        }
                        if (node.isMesh && node.material.normalMap) {
                            console.log('NORMAL MAP=' + node.material.normalMap.name);
                            //var texture = node.material.normalMap;
                            console.log('NORMAL MAP=' + node.material.normalMap);
                            document.querySelector('a-scene').renderer.setTexture2D(node.material.normalMap, 0);

                            this.counter += 1;
                        }
                        if (node.isMesh && node.material.envMap) {
                            this.counter += 1;
                            //var texture = node.material.envMap;
                            console.log('ENV MAP =' + node.material.envMap);
                            document.querySelector('a-scene').renderer.setTexture2D(node.material.envMap, 0);

                        }
                        if (node.isMesh && node.material.bumpMap) {
                            this.counter += 1;
                            // var texture = node.material.bumpMap;
                            console.log('BUMP MAP =' + node.material.bumpMap);
                            document.querySelector('a-scene').renderer.setTexture2D(node.material.bumpMap, 0);

                        }
                        if (node.isMesh && node.material.emissiveMap) {
                            this.counter += 1;
                            // var texture = node.material.emissiveMap;
                            console.log('EMISSIVE MAP =' + node.material.emissiveMap);
                            document.querySelector('a-scene').renderer.setTexture2D(node.material.emissiveMap, 0);

                        }
                        if (node.isMesh && node.material.lightMap) {
                            this.counter += 1;
                            // var texture = node.material.lightMap;
                            console.log('LIGHT MAP =' + node.material.lightMap);
                            document.querySelector('a-scene').renderer.setTexture2D(node.material.lightMap, 0);

                        }
                        if (node.isMesh && node.material.aoMap) {
                            this.counter += 1;
                            // var texture = node.material.aoMap;
                            console.log('Ambien Oclussion MAP =' + node.material.aoMap);
                            document.querySelector('a-scene').renderer.setTexture2D(node.material.aoMap, 0);

                        }
                        if (node.isMesh && node.material.metalnessMap) {
                            this.counter += 1;
                            // var texture = node.material.metalnessMap;
                            console.log('METALNESS MAP =' + node.material.metalnessMap);
                            document.querySelector('a-scene').renderer.setTexture2D(node.material.metalnessMap, 0);
                        }
                        if (node.isMesh && node.material.roughnessMap) {
                            this.counter += 1;
                            // var texture = node.material.roughnessMap;
                            console.log('ROUGHNESS MAP  =' + node.material.roughnessMap);
                            document.querySelector('a-scene').renderer.setTexture2D(node.material.roughnessMap, 0);
                        }
                    });
                    console.log("TOTAL Materials= " + this.counter);
                });
                this.el.object3D.addEventListener('materialtextureloaded', event => {
                    console.log("material model loaded ...");
                });
            }
        });

    </script>
</head>

<body>

    <!-- <audio id="AudioSpeech" crossorigin="anonymous" preload="auto"> -->
    <!-- <source src="Assets/AudioSpeech.mp3" type="audio/mpeg"> -->
    <!-- </audio> -->

    <!-- <a-scene stats mindar-image="imageTargetSrc: /Assets/Targets.mind;" vr-mode-ui="enabled: false" -->
    <a-scene stats mindar-image="imageTargetSrc: /Assets/Targets.mind;" gltf-model="dracoDecoderPath: https://www.gstatic.com/draco/versioned/decoders/1.5.6/;
        basisTranscoderPath:https://cdn.jsdelivr.net/npm/three@0.154.0/examples/jsm/libs/basis/;"
        device-orientation-permission-ui="enabled: false">
        <a-assets timeout="5000">

            <!-- <a-asset-item id="SpeechVideo" src="/Assets/SpeechVideo.fbx" response-type="arraybuffer" -->
            <!-- crossorigin="anonymous"></a-asset-item> -->
            <a-asset-item id="Locutor" src="/Assets/LocutionCompressedTexture.glb"></a-asset-item>
            <a-asset-item id="triceratops" src="https://cdn.aframe.io/examples/ar/models/triceratops/scene.gltf"
                response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
            <img id="icon-play" src="/Assets/PlayMediaIcon.png" />
            <img id="icon-stop" src="/Assets/StopIcon.png" />
        </a-assets>

        <!-- <a-sound id="AudioSpeech" src="#AudioFile"></a-sound> -->
        <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;"
            raycaster="far: ${customFields.libVersion}; objects: .clickable"></a-camera>

        <!-- <a-box position="0 0 -5" rotation="0 45 0" color="#4CC3D9"></a-box> -->
        <!-- <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere> -->

        <a-entity id="mytarget" mytarget mindar-image-target="targetIndex: 0">
            <a-entity locutor_model visible="true" id="LocutorModel" gltf-model="#Locutor" position="0 0 0"
                rotation="90 90 90" scale="0.5 0.5 0.5"></a-entity>
            <!-- <a-entity id="TricModel" gltf-model="#triceratops" position="0 0 0" rotation="90 0 0" -->
            <!-- scale="0.005 0.005 0.005" animation-mixer></a-entity> -->
            <!-- <a-entity id="LocModel" fbx-model="#SpeechVideo" position="0 0 0" rotation="90 90 90" -->
            <!-- scale="0.5 0.5 0.5"></a-entity> -->

            <a-image id="media-button" class="clickable" src="#icon-play" alpha-test="0.8" position="0 -0.5 0"
                height="0.25" width="0.25"
                animation="property: scale; to: 1.2 1.2 1.2; dur: 1000; easing: easeInOutQuad; loop: true; dir: alternate"></a-image>
        </a-entity>
    </a-scene>
</body>

</html>